<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather App</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <style>
        .coordinates {
            background: rgba(0,0,0,0.5);
            color: #fff;
            position: absolute;
            bottom: 40px;
            left: 10px;
            padding:5px 10px;
            margin: 0;
            font-size: 11px;
            line-height: 18px;
            border-radius: 3px;
            display: none;
        }
    </style>

</head>
<body>
<h1>Weather Application</h1>
<div  id="container" class="d-flex flex-wrap justify-content-around"></div>
<pre id='coordinates' class='coordinates'></pre>
<!--<input type="text" placeholder="Latitude"><input type="text" placeholder="Longitude"><input type="button" value="Click Me">-->
<div id="map" style="width: 100%; height: 100%"></div>

<script src="js/jquery-2.2.4.js" ></script>
<script src="js/keys.js"></script>
<script src="js/mapbox-utils.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.1/mapbox-gl.js'></script>

<script>


        var weatherObject = {};

    $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/"+ darkSkyKey +"/29.4241,-98.4936").done(function (weathers) {

        console.log(weathers);

        // $('#container').html(buildHTML(weathers))

        weatherObject = weathers;

    function buildHTML(weathers) {

        console.log(weathers.daily.data);

    var weathersHTML = '';


        for(var i = 0; i < 3; i++ ){

            var weatherCondition = "";

           //Stores the icon string value into this variable-->

            var weatherIcon = weathers.daily.data[i].icon;

            //Cycles through the weatherObjects array

            icons.forEach(function(element) {

// <!--                //check to see if the icon string value is found in the weatherObjects array-->

                if(weatherIcon === element.conditions) {

// <!--                    //Puts the url for the correct image into the weatherCondition variable-->

                    weatherCondition += element.url;

                } //if

            }); //forEach()

        var dateTime = new Date((weathers.daily.data[i].time) * 1000);
            weathersHTML += '<div class="card">';
            weathersHTML += '<ul>';
            weathersHTML += '<li>' + dateTime + '</li>';
            weathersHTML += '<img src=' + weatherCondition + '>';
            weathersHTML += '<li>' + weathers.daily.data[i].apparentTemperatureHigh + ' / ' + weathers.daily.data[i].apparentTemperatureLow + '</li>';
            weathersHTML += '<li>' + weathers.daily.data[i].humidity + '</li>';
            weathersHTML += '</ul>';
            weathersHTML += '</div>'

      }
            return weathersHTML;

   }

   $('#container').html(buildHTML(weatherObject));

    });




    var icons = [
        {
            conditions: 'clear-day',
            url: 'icon/SVG/Sun.svg'
        },
        {
            conditions: 'clear-night',
            url: 'icon/SVG/Moon.svg'
        },
        {
            conditions: 'rain',
            url: 'icon/SVG/Cloud-Rain.svg'
        },
        {
            conditions: 'snow',
            url: 'icon/SVG/Cloud-Snow.svg'
        },
        {
            conditions: 'sleet',
            url: 'icon/SVG/Cloud-Hail.svg'
        },
        {
            conditions: 'wind',
            url: 'icon/SVG/Wind.svg'
        },
        {
            conditions: 'fog',
            url: 'icon/SVG/Cloud-Fog.svg'
        },
        {
            conditions: 'cloudy',
            url: 'icon/SVG/Cloud.svg'
        },
        {
            conditions: 'partly-cloudy-day',
            url: 'icon/SVG/Cloud-Sun.svg'
        },
        {
            conditions: 'partly-cloudy-night',
            url: 'icon/SVG/Cloud-Moon.svg'
        }

    ];

    mapboxgl.accessToken = mapBoxToken;

    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v9',
        center: [-98.273111, 29.801281],
        zoom: 8
    });

    var marker = new mapboxgl.Marker({
        color: 'CornflowerBlue',
        draggable: true
    })
        .setLngLat([-98.273111, 29.801282])
        .addTo(map);


    // map.addControl(new MapboxGeocoder({
    //     accessToken: mapboxgl.accessToken,
    //     // marker: {
    //     //     color: 'CornflowerBlue'
    //     //     // draggable: true
    //     // },
    //
    //     mapboxgl: mapboxgl
    //
    // }));


    var lngLat = [];

    var mapInput = '29.4252, -98.4916';

    function onDragEnd() {
        lngLat = marker.getLngLat();
        mapInput = lngLat.lat + ',' + lngLat.lng;
        coordinates.style.display = 'block';
        coordinates.innerHTML = 'Longitude: ' + lngLat.lng + '<br />Latitude: ' + lngLat.lat;
        weatherUpdate();
    }

    marker.on('dragend', onDragEnd);

    map.addControl(new mapboxgl.NavigationControl());


    function weatherUpdate(){

        $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/"+ darkSkyKey + "/" + mapInput).done(function (weathers) {

            console.log(weathers);

            // $('#container').html(buildHTML(weathers))

            weatherObject = weathers;

            function buildHTML(weathers) {

                console.log(weathers.daily.data);

                var weathersHTML = '';


                for(var i = 0; i < 3; i++ ){

                    var weatherCondition = "";

                    //Stores the icon string value into this variable-->

                    var weatherIcon = weathers.daily.data[i].icon;

                    //Cycles through the weatherObjects array

                    icons.forEach(function(element) {

// <!--                //check to see if the icon string value is found in the weatherObjects array-->

                        if(weatherIcon === element.conditions) {

// <!--                    //Puts the url for the correct image into the weatherCondition variable-->

                            weatherCondition += element.url;

                        } //if

                    }); //forEach()

                    var dateTime = new Date((weathers.daily.data[i].time) * 1000);
                    weathersHTML += '<div class="card">';
                    weathersHTML += '<ul>';
                    weathersHTML += '<li>' + dateTime + '</li>';
                    weathersHTML += '<img src=' + weatherCondition + '>';
                    weathersHTML += '<li>' + weathers.daily.data[i].apparentTemperatureHigh + ' / ' + weathers.daily.data[i].apparentTemperatureLow + '</li>';
                    weathersHTML += '<li>' + weathers.daily.data[i].humidity + '</li>';
                    weathersHTML += '</ul>';
                    weathersHTML += '</div>'

                }
                return weathersHTML;

            }

            $('#container').html(buildHTML(weatherObject));

        });
    }



</script>
</body>
</html>

